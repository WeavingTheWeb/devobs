machine:
  environment:
    SYMFONY__AES__KEY: '_'
    SYMFONY__AES__IV: '_'
    SYMFONY__ANALYTICS__HOST: '_'
    SYMFONY__ANALYTICS__SITE_ID: '_'
    SYMFONY__ASSETIC__NODE: '/home/ubuntu/nvm/versions/node/v4.2.2/bin/node'
    SYMFONY__ASSETIC__MODULES: '/home/ubuntu/nvm/versions/node/v4.2.2/lib/node_modules'
    SYMFONY__APC__HOST: "http://127.0.0.1"
    SYMFONY__API__FACEBOOK__APP_ID: "_"
    SYMFONY__API__FACEBOOK__APP_SECRET: "_"
    SYMFONY__API__FACEBOOK__PROTOCOL: "http://"
    SYMFONY__API__FACEBOOK__HOST_PORT: "127.0.0.1"
    SYMFONY__API__TWITTER__HOST_PORT: 'http://localhost'
    SYMFONY__API__TWITTER__PROTOCOL: 'https://'
    SYMFONY__API__TWITTER__CONSUMER_KEY: "_"
    SYMFONY__API__TWITTER__CONSUMER_SECRET: "_"
    SYMFONY__API__TWITTER__CALLBACK_URL: "http://localhost"
    SYMFONY__API__TWITTER__USER_TOKEN: "_"
    SYMFONY__API__TWITTER__USER_SECRET: "_"
    SYMFONY__API__TWITTER__VERSION: '1.1'
    SYMFONY__ELASTICSEARCH__HOST: "127.0.0.1"
    SYMFONY__ELASTICSEARCH__PORT: "9200"
    SYMFONY__FRAMEWORK__SECRET: '?&}W>kO}f?6mpE,annD{'
    SYMFONY__IMAP__USERNAME: "_"
    SYMFONY__IMAP__PASSWORD: "_"
    SYMFONY__MYSQL__DATABASE: 'circle_test'
    SYMFONY__MYSQL__USER: 'ubuntu'
    SYMFONY__MYSQL__PASSWORD: ''
    SYMFONY__MYSQL__HOST: "127.0.0.1"
    SYMFONY__MYSQL__PORT: "3306"
    SYMFONY__MYSQL__DATABASE_READ: 'circle_test'
    SYMFONY__MYSQL__USER_READ: 'ubuntu'
    SYMFONY__MYSQL__PASSWORD_READ: ''
    SYMFONY__MYSQL__HOST_READ: "127.0.0.1"
    SYMFONY__MYSQL__PORT_READ: "3306"
    SYMFONY__MYSQL__DATABASE_WRITE: 'circle_test'
    SYMFONY__MYSQL__USER_WRITE: 'ubuntu'
    SYMFONY__MYSQL__PASSWORD_WRITE: ''
    SYMFONY__MYSQL__HOST_WRITE: "127.0.0.1"
    SYMFONY__MYSQL__PORT_WRITE: "3306"
    SYMFONY__MYSQL__TEST_DATABASE: 'circle_test'
    SYMFONY__MYSQL__TEST_USER: 'ubuntu'
    SYMFONY__MYSQL__TEST_PASSWORD: ''
    SYMFONY__MYSQL__ADMIN_USER: 'ubuntu'
    SYMFONY__MYSQL__ADMIN_PASSWORD: ''
    SYMFONY__OAUTH__CLIENT_ID: '_'
    SYMFONY__OAUTH__CLIENT_SECRET: '_'
    SYMFONY__OAUTH__ACCESS_TOKEN: '_'
    SYMFONY__QUALITY_ASSURANCE__PASSWORD: 'IL0=?O.]>H^(kvyO*whv'
    SYMFONY__RABBITMQ__USER: 'ubuntu'
    SYMFONY__RABBITMQ__PASSWORD: ''
    SYMFONY__RABBITMQ__HOST: "127.0.0.1"
    SYMFONY__RABBITMQ__VHOST: "/"
  timezone:
    Europe/Paris
  node:
    version: 4.2.2
  php:
    version: 5.5.11
  services:
    - mysql
    - redis
    - elasticsearch
    - rabbitmq-server

dependencies:
  override:
    - npm install
    - npm install -g bower
    - /bin/bash -c 'source tests/.install-bower-components.sh'
  post:
    - wget https://saucelabs.com/downloads/sc-latest-linux.tar.gz
    - tar -xzf sc-latest-linux.tar.gz
  cache_directories:
    - src/WeavingTheWeb/Bundle/DashboardBundle/Resources/public/components
    - tests/bower_components
    - node_modules
    - vendor
  pre:
    - /bin/bash -c 'cp app/config/parameters.yml{.dist,}'
    - /bin/bash -c 'test -d ~/.composer || mkdir ~/.composer'
    - source ./tests/.configure-composer-auth.sh

test:
  override:
    - cd sc-*-linux && ./bin/sc -u $SAUCE_USERNAME -k $SAUCE_ACCESS_KEY:
        background: true
    - npm test
